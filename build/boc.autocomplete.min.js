/*! boc.autocomplete 2015-03-03 */
!function(){"use strict";var a=window.JsonHttp=function(){this.xhr=new XMLHttpRequest};a.prototype={get:function(a,b){var c=this.xhr;c.onreadystatechange=function(){4===this.readyState&&(200===this.status?b(null,this.response):b("error"))},c.open("GET",a),c.responseType="json",c.send()}}}(),function(){"use strict";var a={RETURN:13,TAB:9,DOWN:40,UP:38},b=window.Autocomplete=function(a,c){this.input=a,this.input.autocomplete="off",this.input.className="autocomplete",this.ul=document.createElement("ul"),this.ul.className="autocomplete",this.options={url:c.url+"?"+c.param+"=",label:c.label,select:c.select},a.addEventListener("input",this.inputListener.bind(this)),a.addEventListener("keydown",this.keydownListener.bind(this)),b.insertAfter(this.ul,this.input)};b.prototype={select:function(a,c){a.input.value=c.innerHTML,a.options.select&&a.options.select(JSON.parse(c.dataset.item)),b.removeChildren(a.ul)},inputListener:function(){var a=this,c=new window.JsonHttp,d=a.options.url+encodeURIComponent(a.input.value);c.get(d,function(c,d){b.removeChildren(a.ul),c?(a.input.placeholder="error fetching data...",a.input.value=""):d.forEach(function(b){var c=document.createElement("li");c.appendChild(document.createTextNode(b[a.options.label])),c.setAttribute("data-item",JSON.stringify(b)),c.addEventListener("click",function(){a.select(a,this)}),a.ul.appendChild(c)})})},keydownListener:function(c){var d;c.keyCode===a.DOWN?(d=this.ul.querySelector(".selected"),d?d.nextSibling&&(d.className="",d=d.nextSibling,d.className=b.SELECTED_CLASS):(d=this.ul.firstChild,d.className=b.SELECTED_CLASS)):c.keyCode===a.UP?(d=this.ul.querySelector(".selected"),d&&(d.previousSibling?(d.className="",d=d.previousSibling,d.className=b.SELECTED_CLASS):(d.className="",d=null))):c.keyCode===a.TAB&&this.ul.firstChild?(d=this.ul.querySelector(".selected"),c.preventDefault(),d?this.select(this,d):this.select(this,this.ul.firstChild)):c.keyCode===a.RETURN&&this.ul.firstChild&&(d=this.ul.querySelector(".selected"),c.preventDefault(),d&&this.select(this,d))}},b.SELECTED_CLASS="selected",b.insertAfter=function(a,b){b.parentNode.insertBefore(a,b.nextSibling)},b.removeChildren=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)}}(window);